# 祖瑪 (Zuma) 遊戲設計與開發文檔

## 1. 遊戲概述
- 遊戲類型：益智消除 (Puzzle / Tile-matching)、彈珠射擊
- 核心目標：控制中央發射台，發射彩球進入軌道上的移動球鏈。當三個或更多同色球相連時消除它們。
- 失敗條件：球鏈最前端到達終點（通常是骷髏洞口）。
- 視角：2D 俯視視角。

---

## 2. 核心玩法機制

### 2.1 軌道與球鏈
- **路徑**：每個關卡有一條或多條預定義的曲線路徑。
- **移動邏輯**：隊伍最後面的球推著前面的球走。如果球鏈中間被消除打斷，前段球鏈會暫時停止，直到後段球鏈移動撞上前方球鏈，或者前段球鏈「倒退」回來接上（磁吸效應）。

### 2.2 射擊機制
- **發射台**：位於畫面中央，可 360 度旋轉。
- **彈藥生成**：發射台生成的球種，必定是當前軌道上存在的顏色。若某顏色已全部消除，則不會再生成該顏色的球。
- **彈藥切換**：發射台嘴裡含著「當前球」，背部顯示「下一顆球」。玩家可按鍵交換這兩顆球。
- **插入判定**：
    - 球擊中軌道上的球鏈時，會強行擠入擊中點的兩球之間。
    - 這不會像物理碰撞那樣彈開，而是修改球鏈的排序。

### 2.3 消除與連鎖
- **基本消除**：當射入的球導致 3 顆或以上同色球相連，這些球爆炸消失。
- **縫隙閉合 (Gap Closing)**：消除後軌道會產生空隙。如果空隙兩端的球顏色相同，它們會互相吸引（通常是前段倒退），重新接合。
- **連鎖 (Combo)**：如果接合後的球又形成了 3 顆以上的同色組合，會再次觸發消除，這是高分關鍵。

---

## 3. 道具系統
道具球通常是隨機生成在球鏈中的特殊外觀球，玩家消除該球時觸發效果：

1.  **倒退球**：所有球鏈向起點方向倒退移動，持續 2~5 秒。
2.  **減速球**：球鏈移動速度降低 50%，讓瞄準更容易。
3.  **炸彈球**：消除以該球為中心，一定半徑範圍內的所有球（無視顏色）。
4.  **準心球**：增加一條雷射射線指引，並大幅提高發射速度，適合用於難度高的縫隙射擊。

---

## 4. 技術實作指南 (程式與架構)

這部分是實作的核心，重點在於選擇正確的數據結構來處理球的插入與移除。

### 4.1 數據結構：雙向鏈結串列 (Doubly Linked List)
請避免使用陣列 (Array) 存儲球鏈，因為頻繁的插入和移除會造成大量的記憶體搬移。

- **建議結構**：每個球是一個節點 (Node)。
- **節點屬性**：顏色、當前路徑距離 (Distance)、前一個球 (Prev)、後一個球 (Next)。
- **優勢**：當玩家射中兩個球之間，只需改變前後球的指標 (Reference)，運算複雜度為 O(1)。當球鏈斷裂時，邏輯上視為兩個獨立的鏈表處理即可。

### 4.2 路徑系統
- **曲線生成**：使用貝塞爾曲線 (Bézier Curves) 或樣條曲線 (Splines)。
- **採樣**：將曲線採樣為一組密集的點座標 (Vector2 Array)。
- **定位方式**：
    - 不要依賴物理引擎推球。
    - 每個球只記錄一個 float 類型的 `distance` 值。
    - 透過函數 `GetPointAtDistance(distance)` 來計算球在畫面上的實際 (x, y) 座標。

### 4.3 碰撞檢測
- **檢測方式**：簡單的圓形半徑檢測。
- **插入邏輯**：
    1.  檢測射出的球與軌道球碰撞。
    2.  計算碰撞角度，決定插入在目標球的「前」還是「後」。
    3.  更新鏈結串列，插入新節點。
    4.  立刻執行消除檢查算法。

### 4.4 關卡數據範例 (JSON)
使用 JSON 定義關卡方便調整平衡：

```json
{
  "level_id": 1,
  "path_points": [{"x":0, "y":500}, {"x":10, "y":495}, ...],
  "wave_settings": {
    "speed": 5.0,
    "colors_active": ["red", "blue", "green", "yellow"],
    "total_balls": 100
  }
}
```

---

## 5. 評分系統
- **消除得分**：基礎分 10 分/顆。
- **Combo 加成**：連鎖次數越高，倍率越高。
- **縫隙射擊 (Gap Shot)**：球穿過兩段球鏈之間的空隙並成功消除後面的球，給予高額獎勵分。

---

## 6. 開發優先順序建議

1.  **路徑原型**：先讓一串球能沿著設定好的線移動，暫時忽略消除邏輯。
2.  **插入機制**：實作滑鼠點擊發射，並正確將球「插入」到移動的隊伍中。
3.  **消除邏輯**：實作三消規則與斷裂後的磁吸回補。
4.  **完整化**：最後才加入圖片素材、特效、道具球與關卡編輯器。